-- Aetherium GobbleGum Mapping
-- Contains all GobbleGum definitions for cursor hint detection

-- GobbleGum Data Table
-- Each entry contains name, icon, and description for display
-- NOTE: The last entry should NOT have a comma ","
CoD.AetheriumBBGData = {
	{
		name = "Always Done Swiftly",
		icon = "t7_hud_zm_bgb_always_done_swiftly",
		description = "Walk faster when aiming. Raise and lower your weapon to aim more quickly."
	},
	{
		name = "Arms Grace",
		icon = "t7_hud_zm_bgb_arms_grace",
		description = "Respawn with the guns the player had when they bled out."
	},
	{
		name = "Coagulant",
		icon = "t7_hud_zm_bgb_coagulant",
		description = "Longer bleed out time"
	},
	{
		name = "In Plain Sight",
		icon = "t7_hud_zm_bgb_in_plain_sight",
		description = "All Zombies ignore the player."
	},
	{
		name = "Stock Option",
		icon = "t7_hud_zm_bgb_stock_option",
		description = "Ammo is taken from the player's stockpile instead of their weapon's magazine."
	},
	{
		name = "Impatient",
		icon = "t7_hud_zm_bgb_impatient",
		description = "Respawn near the end of the current round instead of at the start of the next round."
	},
	{
		name = "Sword Flay",
		icon = "t7_hud_zm_bgb_sword_flay",
		description = "Melee attacks and any melee weapon will inflict 5x more damage on Zombies."
	},
	{
		name = "Anywhere But Here!",
		icon = "t7_hud_zm_bgb_anywhere_but_here",
		description = "Instantly teleport to a random location."
	},
	{
		name = "Danger Closest",
		icon = "t7_hud_zm_bgb_danger_closest",
		description = "Zero explosive damage."
	},
	{
		name = "Armamental Accomplishment",
		icon = "t7_hud_zm_bgb_armamental_accomplishment",
		description = "Switch weapons and recover from performing melee attacks faster. "
	},
	{
		name = "Firing On All Cylinders",
		icon = "t7_hud_zm_bgb_firing_on_all_cylinders",
		description = "Can fire while sprinting."
	},
	{
		name = "Arsenal Accelerator",
		icon = "t7_hud_zm_bgb_arsenal_accelerator",
		description = "Charge the player's special weapon faster."
	},
	{
		name = "Lucky Crit",
		icon = "t7_hud_zm_bgb_lucky_crit",
		description = "Improves your chances of activating an Alternate Ammo Type"
	},
	{
		name = "Now You See Me",
		icon = "t7_hud_zm_bgb_now_you_see_me",
		description = "All zombies will chase the player."
	},
	{
		name = "Alchemical Antithesis",
		icon = "t7_hud_zm_bgb_alchemical_antithesis",
		description = "Every 10 points earned is instead awarded 1 ammo in the stock of the current weapon."
	},
	{
		name = "Projectile Vomiting",
		icon = "t7_hud_zm_bgb_projectile_vomiting",
		description = "Zombies you kill with grenades or other large projectiles vomit uncontrollably."
	},
	{
		name = "Newtonian Negation",
		icon = "t7_hud_zm_bgb_newtonian_negation",
		description = "Zombies killed fall straight up."
	},
	{
		name = "Eye Candy",
		icon = "t7_hud_zm_bgb_eye_candy",
		description = "Overrides the colors you see. Creates color overlay that highlights zombies."
	},
	{
		name = "Tone Death",
		icon = "t7_hud_zm_bgb_tone_death",
		description = "A set of random silly zombie sounds and death sounds are played instead of the normal ones."
	},
	{
		name = "Aftertaste",
		icon = "t7_hud_zm_bgb_aftertaste",
		description = "Keep all Perks after being revived. "
	},
	{
		name = "Burned Out",
		icon = "t7_hud_zm_bgb_burned_out",
		description = "The next time the player takes damage, nearby zombies burst into fire."
	},
	{
		name = "Dead of Nuclear Winter",
		icon = "t7_hud_zm_bgb_dead_of_nuclear_winter",
		description = "Spawns a Nuke Power-Up."
	},
	{
		name = "Ephemeral Enhancement",
		icon = "t7_hud_zm_bgb_ephemeral_enhancement",
		description = "Turns the weapon in the player's hands into the Pack-A-Punched version for 60 seconds."
	},
	{
		name = "I'm Feeling Lucky",
		icon = "t7_hud_zm_bgb_im_feelin_lucky",
		description = "Spawns a random Power-Up in the map."
	},
	{
		name = "Immolation Liquidation",
		icon = "t7_hud_zm_bgb_immolation_liquidation",
		description = "Spawns a Fire Sale Power-Up."
	},
	{
		name = "Licensed Contractor",
		icon = "t7_hud_zm_bgb_licensed_contractor",
		description = "Spawns a Carpenter Power-Up."
	},
	{
		name = "Phoenix Up",
		icon = "t7_hud_zm_bgb_phoenix_up",
		description = "Revives all teammates. Teammates keep all of their Perks."
	},
	{
		name = "Pop Shocks",
		icon = "t7_hud_zm_bgb_pop_shocks",
		description = "Melee attacks trigger an electrostatic discharge, electrocuting nearby Zombies."
	},
	{
		name = "Respin Cycle",
		icon = "t7_hud_zm_bgb_respin_cycle",
		description = "Re-spins the weapons in the Mystery Box after it has been activated."
	},
	{
		name = "Unquenchable",
		icon = "t7_hud_zm_bgb_unquenchable",
		description = "Spawns a Double Points Power-Up."
	},
	{
		name = "Crawl Space",
		icon = "t7_hud_zm_bgb_crawl_space",
		description = "	All nearby zombies become crawlers."
	},
	{
		name = "Fatal Contraption",
		icon = "t7_hud_zm_bgb_fatal_contraption",
		description = "Spawns a Death Machine Power-Up."
	},
	{
		name = "Unbearable",
		icon = "t7_hud_zm_bgb_unbearable",
		description = "The Mystery Auto-activates when the Teddy Bear appears in the Mystery box "
	},
	{
		name = "Disorderly Combat",
		icon = "t7_hud_zm_bgb_disorderly_combat",
		description = "Gives a random gun every 10 seconds. "
	},
	{
		name = "Slaughter Slide",
		icon = "t7_hud_zm_bgb_slaughter_slide",
		description = "Create 2 lethal explosions by sliding. 6x Activations"
	},
	{
		name = "Mind Blown",
		icon = "t7_hud_zm_bgb_mind_blown",
		description = "Gib the heads of all the zombies you can see, killing them."
	},
	{
		name = "Board Games",
		icon = "t7_hud_zm_bgb_board_games",
		description = "Fixing one board at a barrier fixes all the boards at that barrier. "
	},
	{
		name = "Board To Death",
		icon = "t7_hud_zm_bgb_board_to_death",
		description = "Selects a random Mega GobbleGum of any rarity that is not in the player's loadout"
	},
	{
		name = "Idle Eyes",
		icon = "t7_hud_zm_bgb_idle_eyes",
		description = "All zombies ignore all players and stand idle."
	},
	{
		name = "Cache Back",
		icon = "t7_hud_zm_bgb_cache_back",
		description = "Spawns a Max Ammo Power-Up."
	},
	{
		name = "Kill Joy",
		icon = "t7_hud_zm_bgb_kill_joy",
		description = "Spawns an Insta-Kill Power-Up."
	},
	{
		name = "On the House",
		icon = "t7_hud_zm_bgb_on_the_house",
		description = "Spawns a Random Perk Bottle Power Up."
	},
	{
		name = "Wall Power",
		icon = "t7_hud_zm_bgb_wall_power",
		description = "The next wall weapon purchased becomes Pack-a-Punched."
	},
	{
		name = "Undead Man Walking",
		icon = "t7_hud_zm_bgb_undead_man_walking",
		description = "Slow down all zombies to shambling speed."
	},
	{
		name = "Fear in Headlights",
		icon = "t7_hud_zm_bgb_fear_in_headlights",
		description = "Zombies seen by the player will not move. Players should remember this will not affect zombies that are behind them."
	},
	{
		name = "Temporal Gift",
		icon = "t7_hud_zm_bgb_temporal_gift",
		description = "Power ups last longer (extra 30 seconds)."
	},
	{
		name = "Crate Power",
		icon = "t7_hud_zm_bgb_crate_power",
		description = "The next gun taken from the Mystery Box comes Pack-a-Punched. "
	},
	{
		name = "Bullet Boost",
		icon = "t7_hud_zm_bgb_bullet_boost",
		description = "Re-Pack current Pack-a-Punched gun if possible."
	},
	{
		name = "Extra Credit",
		icon = "t7_hud_zm_bgb_extra_credit",
		description = "Spawns a personal Bonus Points Power-Up worth 1,250 points"
	},
	{
		name = "Soda Fountain",
		icon = "t7_hud_zm_bgb_soda_fountain",
		description = "Perk purchase limit is ignored. Every perk you buy, a random perk is awarded along with the perk you bought."
	},
	{
		name = "Killing Time",
		icon = "t7_hud_zm_bgb_killing_time",
		description = "All zombies freeze in place for 20 seconds. "
	},
	{
		name = "Perkaholic",
		icon = "t7_hud_zm_bgb_perkaholic",
		description = " immediately	Gives the player all Perk-a-Colas available on the map."
	},
	{
		name = "Head Drama",
		icon = "t7_hud_zm_bgb_head_drama",
		description = "Any bullet which hits a zombie will damage its head."
	},
	{
		name = "Secret Shopper",
		icon = "t7_hud_zm_bgb_secret_shopper",
		description = "Any gun wall-buy can be used to buy ammo for any gun. "
	},
	{
		name = "Shopping Free",
		icon = "t7_hud_zm_bgb_shopping_free",
		description = "All purchases are free, lasts 1 minute."
	},
	{
		name = "Near Death Experience",
		icon = "t7_hud_zm_bgb_near_death_experience",
		description = "Revive, or be revived simply by being near other players."
	},
	{
		name = "Profit Sharing",
		icon = "t7_hud_zm_bgb_profit_sharing",
		description = "Points you earn are also received by nearby players and vice versa."
	},
	{
		name = "Round Robbin'",
		icon = "t7_hud_zm_bgb_round_robbin",
		description = "Ends the current round. All players gain 1600 points."
	},
	{
		name = "Self Medication",
		icon = "t7_hud_zm_bgb_self_medication",
		description = "Self-revive; keep all the Perks including Quick Revive"
	},
	{
		name = "Power Vacuum",
		icon = "t7_hud_zm_bgb_power_vacuum",
		description = "Power-Ups spawn more often. The drop chance is greatly increased"
	},
	{
		name = "Reign Drops",
		icon = "t7_hud_zm_bgb_reign_drops",
		description = "Spawns all the core Power-Ups at once."
	},

}

-- Item Index to Icon Mapping
-- Maps BO3's internal itemIndex (from GetBubbleGumBuff) to icon names
-- Built from observed in-game values - expand as needed
CoD.AetheriumBBGItemIndexMap = {
	[202] = "t7_hud_zm_bgb_in_plain_sight",  -- Add more as you discover them
	-- Add more mappings here as you test different gobblegums
}

-- Helper function to get icon from item index
-- Returns icon name string, or nil if not found
CoD.GetGobbleGumIconByItemIndex = function(itemIndex)
	if not itemIndex then
		return nil
	end
	
	-- First check the itemIndex map
	local icon = CoD.AetheriumBBGItemIndexMap[itemIndex]
	if icon then
		return icon
	end
	
	-- If not in map, return nil (we'll add it later)
	return nil
end

-- Helper function to find GobbleGum by name from hint text
-- Returns the full GobbleGum data table entry, or nil if not found
CoD.GetGobbleGumFromHint = function(hintText)
	if not hintText or hintText == "" then
		return nil
	end
	
	local lowerHint = string.lower(hintText)
	
	for i = 1, #CoD.AetheriumBBGData do
		local ggName = string.lower(CoD.AetheriumBBGData[i].name)
		
		-- Check if the gobblegum name is in the hint text
		if string.find(lowerHint, ggName) then
			return CoD.AetheriumBBGData[i]
		end
		
		-- Also check for partial matches (useful for multi-word names)
		-- e.g., "Anywhere But Here" might appear as "anywhere" in hint
		local words = {}
		for word in string.gmatch(ggName, "%S+") do
			table.insert(words, word)
		end
		
		-- If all words from the GG name are found in the hint, it's a match
		local allWordsFound = true
		for _, word in ipairs(words) do
			if not string.find(lowerHint, word) then
				allWordsFound = false
				break
			end
		end
		
		if allWordsFound and #words > 0 then
			return CoD.AetheriumBBGData[i]
		end
	end
	
	return nil
end

-- Helper function to check if hint text is a GobbleGum interaction
-- Returns true if the hint is for a gobblegum (machine or pickup)
CoD.IsGobbleGumHint = function(hintText)
	if not hintText or hintText == "" then
		return false
	end
	
	local lowerHint = string.lower(hintText)
	
	-- Check for machine interaction: "dispense" and "gobblegum" or "gum"
	if string.find(lowerHint, "dispense") and (string.find(lowerHint, "gobblegum") or string.find(lowerHint, "gum")) then
		return true
	end
	
	-- Check for gobblegum pickup: "hold f for <gobblegum_name>"
	-- Use the GetGobbleGumFromHint function to validate it's a real GG
	if string.find(lowerHint, "hold") and string.find(lowerHint, "for") then
		local ggData = CoD.GetGobbleGumFromHint(hintText)
		if ggData ~= nil then
			return true
		end
	end
	
	return false
end

return CoD.AetheriumBBGData